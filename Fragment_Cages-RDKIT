import rdkit
from rdkit.Chem import AllChem

mol = AllChem.MolFromMolFile('input.mol')
imine = AllChem.MolFromSmiles('CC=NC')
subs = mol.GetSubstructMatches(imine)

bonds = []
for i in subs:
  bonds.append(i[1:3])
bond_ids = [mol.GetBondBetweenAtoms(x,y).GetIdx() for x,y in bonds]
new_mol = AllChem.FragmentOnBonds(mol,bond_ids)

new_smiles = AllChem.MolToSmiles(new_mol, True)
new_split = new_smiles.split('.')

corrected_fragments = []
for i in new_split:
  a = AllChem.ReplaceSubstructs(AllChem.MolFromSmiles(str(i)), AllChem.MolFromSmarts('C=[!R]'), AllChem.MolFromSmarts('C=O'), replaceAll=True)
  b = AllChem.MolToSmiles(a[0])
  c = AllChem.MolFromSmiles(b)
  d = AllChem.ReplaceSubstructs(c, AllChem.MolFromSmarts('N=[!R]'), AllChem.MolFromSmarts('N'), replaceAll=True)
  corrected_fragments.append(d[0])

smiles_fragments = []
for i in corrected_fragments:
        smiles_fragments.append(AllChem.MolToSmiles(i))

building_blocks_dict = {i:smiles_fragments.count(i) for i in smiles_fragments}
print(building_blocks_dict)
